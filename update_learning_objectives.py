#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
학습목표 3영역 보정 스크립트
지식·이해, 과정·기능, 가치·태도로 재구성
"""

import re
from pathlib import Path

# 블록별 학습목표 (3영역으로 재구성)
LEARNING_OBJECTIVES = {
    "블록01": {
        "지식·이해": "일상생활과 환경의 연결성을 이해할 수 있다.",
        "과정·기능": "환경과 나의 삶이 글로벌하게 연결되어 있음을 파악할 수 있다.",
        "가치·태도": "환경에 대한 궁금증과 탐구 의욕을 가질 수 있다."
    },
    "블록02": {
        "지식·이해": "일상 속 환경문제와 개인의 선택이 지역·국제적 환경에 미치는 영향을 이해할 수 있다.",
        "과정·기능": "우리 생활 속에서 환경문제를 발견하고 분석할 수 있다.",
        "가치·태도": "환경문제에 관심을 가지고 적극적으로 탐색하려는 태도를 가질 수 있다."
    },
    "블록03": {
        "지식·이해": "개인의 선택이 지역과 세계 환경에 미치는 영향을 이해할 수 있다.",
        "과정·기능": "환경 발자국 개념을 이해하고 나의 환경 발자국을 계산할 수 있다.",
        "가치·태도": "일상 속 선택을 환경친화적으로 바꾸려는 태도를 가질 수 있다."
    },
    "블록04": {
        "지식·이해": "환경문제 해결을 위한 다양한 태도와 접근 방식을 이해할 수 있다.",
        "과정·기능": "환경문제 해결 과정에서 나의 역할과 책임을 탐색할 수 있다.",
        "가치·태도": "환경문제를 해결하려는 적극적인 태도와 변화를 이끌어낼 수 있다는 신념을 가질 수 있다."
    },
    "블록05": {
        "지식·이해": "기후변화의 원인과 전 지구적 영향을 이해할 수 있다.",
        "과정·기능": "기후변화 현상을 관찰하고 원인과 결과를 분석할 수 있다.",
        "가치·태도": "기후변화 문제에 관심을 가지고 해결에 동참하려는 마음을 가질 수 있다."
    },
    "블록06": {
        "지식·이해": "생물다양성의 의미와 중요성을 이해할 수 있다.",
        "과정·기능": "생물다양성 감소의 원인을 조사하고 보전 방안을 제안할 수 있다.",
        "가치·태도": "생물다양성을 지키려는 마음과 생명 존중 태도를 가질 수 있다."
    },
    "블록07": {
        "지식·이해": "지속가능발전의 개념과 SDGs를 이해할 수 있다.",
        "과정·기능": "지속가능한 미래를 위한 국제 협력 사례를 조사하고 분석할 수 있다.",
        "가치·태도": "지속가능한 미래를 위해 서로 연대하여 협력하려는 마음을 가질 수 있다."
    },
    "블록08": {
        "지식·이해": "영역1(세계화와 상호의존)의 핵심 개념을 종합적으로 이해할 수 있다.",
        "과정·기능": "학습한 내용을 바탕으로 환경문제 해결 방안을 제안할 수 있다.",
        "가치·태도": "학습 과정을 성찰하고 세계시민으로서의 책임감을 가질 수 있다."
    },
    "블록09": {
        "지식·이해": "세계화와 환경문제의 연결성을 이해할 수 있다.",
        "과정·기능": "세계화로 인한 환경문제 사례를 조사하고 상호의존성을 파악할 수 있다.",
        "가치·태도": "세계 공동의 문제 해결에 관심을 가지고 공감하는 태도를 가질 수 있다."
    },
    "블록10": {
        "지식·이해": "환경문제의 복잡성과 불확실성을 이해할 수 있다.",
        "과정·기능": "환경문제의 특성(연결성, 불확실성, 복잡성)을 분석하고 추론할 수 있다.",
        "가치·태도": "복잡한 환경문제 해결을 위해 협력하려는 태도를 가질 수 있다."
    },
    "블록11": {
        "지식·이해": "지속가능한 미래를 위한 국제 협력의 필요성을 이해할 수 있다.",
        "과정·기능": "환경문제 해결을 위한 국제 협력 방안을 탐색하고 제안할 수 있다.",
        "가치·태도": "세계 공동체의 일원으로서 연대와 협력의 가치를 실천하려는 태도를 가질 수 있다."
    },
    "블록12": {
        "지식·이해": "지속가능한 미래를 저해하는 요인들을 이해할 수 있다.",
        "과정·기능": "지속가능한 미래의 저해 요인을 탐색하고 분석할 수 있다.",
        "가치·태도": "지속가능한 미래를 만들기 위한 변화의 책임에 공감할 수 있다."
    },
    "블록13": {
        "지식·이해": "환경 감수성의 의미와 중요성을 이해할 수 있다.",
        "과정·기능": "환경 감수성을 기르는 다양한 방법을 탐색하고 실천할 수 있다.",
        "가치·태도": "환경에 대한 감수성과 환경친화적인 태도를 가질 수 있다."
    },
    "블록14": {
        "지식·이해": "생태전환적 삶의 의미와 필요성을 이해할 수 있다.",
        "과정·기능": "생활 속에서 생태전환을 실천할 수 있는 방법을 찾고 계획할 수 있다.",
        "가치·태도": "생태전환적 삶을 실천하려는 의지와 태도를 가질 수 있다."
    },
    "블록15": {
        "지식·이해": "학교와 지역사회의 생태전환 필요성을 이해할 수 있다.",
        "과정·기능": "학교와 지역사회의 생태전환 프로젝트를 기획하고 실천할 수 있다.",
        "가치·태도": "공동체와 함께 생태전환을 실천하려는 책임감과 협력 태도를 가질 수 있다."
    },
    "블록16": {
        "지식·이해": "영역2(생태전환)의 핵심 개념을 종합적으로 이해할 수 있다.",
        "과정·기능": "학습한 내용을 바탕으로 생태전환 실천 계획을 수립할 수 있다.",
        "가치·태도": "학습 과정을 성찰하고 생태전환적 삶을 실천하려는 의지를 가질 수 있다."
    },
    "블록17": {
        "지식·이해": "32차시 학습을 통해 환경과 삶의 관계를 종합적으로 이해할 수 있다.",
        "과정·기능": "학습 과정을 성찰하고 미래 실천 계획을 수립할 수 있다.",
        "가치·태도": "세계시민으로서 환경 책임을 다짐하고 지속적으로 실천하려는 태도를 가질 수 있다."
    }
}

def update_html_objectives(file_path, block_num):
    """HTML 파일의 학습목표를 3영역으로 업데이트"""
    with open(file_path, 'r', encoding='utf-8') as f:
        content = f.read()
    
    block_key = f"블록{block_num:02d}"
    if block_key not in LEARNING_OBJECTIVES:
        print(f"⚠️  {block_key} 학습목표 정의되지 않음")
        return False
    
    objectives = LEARNING_OBJECTIVES[block_key]
    new_objectives = f"""[지식·이해] {objectives['지식·이해']}
[과정·기능] {objectives['과정·기능']}
[가치·태도] {objectives['가치·태도']}"""
    
    # 학습목표 섹션 찾기 (정규식)
    pattern = r'(<th>학습목표</th>\s*<td class="full-width" colspan="3">)(.*?)(</td>)'
    
    def replace_objectives(match):
        return match.group(1) + new_objectives + match.group(3)
    
    new_content = re.sub(pattern, replace_objectives, content, flags=re.DOTALL)
    
    if new_content != content:
        with open(file_path, 'w', encoding='utf-8') as f:
            f.write(new_content)
        return True
    return False

def main():
    base_dir = Path("/Users/macqs/Documents/남대구초 교육과정 프로젝트/11월 7일(금)/환경과 삶")
    
    # docs/지도안 폴더
    docs_lesson_dir = base_dir / "docs" / "지도안"
    # 지도안 폴더
    lesson_dir = base_dir / "지도안"
    
    updated_count = 0
    
    for block_num in range(1, 18):
        filename = f"블록{block_num:02d}_지도안_*.html"
        
        # docs/지도안 업데이트
        for file_path in docs_lesson_dir.glob(filename):
            if update_html_objectives(file_path, block_num):
                print(f"✅ 업데이트: {file_path.name}")
                updated_count += 1
        
        # 지도안 업데이트
        for file_path in lesson_dir.glob(filename):
            if update_html_objectives(file_path, block_num):
                print(f"✅ 업데이트: {file_path.name}")
                updated_count += 1
    
    print(f"\n📊 총 {updated_count}개 파일 업데이트 완료")

if __name__ == "__main__":
    main()
